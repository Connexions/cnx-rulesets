@mixin modify_trash($selector) {
  #{$selector} {
    move-to: trash;
  }
}

@mixin modify_titlePreface() {
  //This only changes a container
  //will this be needed once the headers in raw are changed?
  div.preface {
    > [data-type="document-title"] {
      container: h1;
      content: content();
    }
  }
}

@mixin modify_compositeAutoID() {
  div[data-type="composite-page"] {
    attr-id: uuid() "@1";
  }
}

@mixin modify_chapterAutoID() {
  div[data-type='chapter'] {
    > h1[data-type='document-title'] {
      counter-increment: chapTitleNum;
      attr-id: "chapTitle" counter(chapTitleNum);
    }
  }
}

@mixin modify_suppressURI() {
  div.os-eoc, div.os-eob  {
    [data-type="cnx-archive-uri"] {
      move-to: trash;
    }
  }
}

@mixin modify_spanWrapTitles() {
  :not([data-type="metadata"]) > [data-type="document-title"] {
    content: '';
    &::after {
      content: content();
      container: span;
      class: "os-text";
    }
  }
}

@mixin modify_simLinkTarget() {
  a[href*="archive.cnx.org/specials/"] {
    attr-target: "_blank";
  }
}

@mixin modify_prepIndexTerms($termCounter, $pageIDString) {
  div[data-type="page"],
  div[data-type="composite-page"] {
    span[data-type="term"] {
      attr-id: "auto_" string($pageIDString) "_term" counter($termCounter);
      &:match("^[a-zA-Z]") {
        attr-group-by: first-letter(content());
      }
      &:match("^[^a-zA-Z]") {
        attr-group-by: "";
      }
    }
  }
}

@mixin modify_addIndexSymbolGroup($location, $name) {
  .os-#{$location}-container > div.group-by:first-of-type > span.group-label {
    content: $name;
  }
}

@mixin modify_compositeMetadata($bookMetadata) {
  [data-type="composite-page"] {
    content: nodes($bookMetadata) content();
  }
}

@mixin modify_retitleCompositeMetadata() {
  [data-type="composite-page"] {
    > [data-type="document-title"] {
      string-set: doc-title-TOMETADATA content();
    }
    > [data-type="metadata"] {
      > [data-type="document-title"] {
        content: string(doc-title-TOMETADATA);
      }
    }
  }
}


@mixin modify_note($noteContent) {
  $selector: map-get($noteContent, selector);
  $label: map-get($noteContent, label);
  $isBodyWrapped: map-get($noteContent, isBodyWrapped);
  [data-type="note"].#{$selector} {
    &::before {
      container: span;
      class: "os-title-label";
      content: $label;
      move-to: bNoteLabel;
    }
    &::before {
      container: h3;
      content: pending(bNoteLabel);
      class: "os-title";
      move-to: bNoteHeader;
    }
    @if ($isBodyWrapped) {
      &::after {
          class: "os-note-body";
          content: content();
          move-to: cNote;
      }
      &::deferred {
        content:pending(bNoteHeader) pending(cNote);
      }
    }
    @else {
      &::deferred {
        content:pending(bNoteHeader)content();
      }
    }
  }
}

@mixin modify_retitleHeaders () {
  [data-type="chapter"] {
    [data-type="page"] {
      [data-type="note"] {
        > .os-title {
          container: h3;
        }
        .os-body > [data-type="title"] {
          class: "os-subtitle";
          container: h4;
        }
      }
    }
  }
}
